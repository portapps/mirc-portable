os: windows
language: shell

env:
  global:
    - GOVERSION: 1.12.4
    - NODEJS_VERSION: 11.14.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: jhjfD9+6EyPqbPITYz3dGr6n6weM5XBVF2BrtU+8m4h3Sn2RXwg1Hfv0nx9AWWpmoBRrDNFnUmb/B87gX6ykcDwZ9JlAR1KsfbTMIFf+98s4zPLekLuWQKnRjRKmrFrhiawJ94yEjm0ENDOHXfn5DjeZRmS8/70pwBe36MnBMAsH+PRoJrJqSxi6/Dzw1GCIrLcyFyt6goTS/RR6tyu4FXH1ENfu+UF7HGGlvTWFMjcRabTvpQ3Tv3nPU44OeIef2lG36tQNtXPTgGD2XQes/6I1gj7FNqxXnQBnvxeZP8xNqjHECUBYBIPB1muCwUlyrdQRN4azTWte6mvy3/FFxEYp9rH9dUFkmoc9W0huzdk/dffF/bAAWAGo9e37CJw/kOEGvQAh9EmoLrlu6WXCpEk/5HsNeZwho7ZSiG/p1fkCM0UNxE29vJg0+eDS0i780qM8lQa59tpGUy45LXBZuTbv8JCMw2NSnd9E+1iyI6tCJ+3WAPw/mLqe9427QF6rCDdoMyLgrPeKomAlnVWWymVQ7fFM3VcoI9urObO95/GoBMC2M1hzaFwY2UOxM41S7R6v2acPtjEoHneA+fl4JzrBxhPrPThrQgkf1Zl2Ku5ePB2hDgMjxIm2FcZGTP0d1mVDHr79F+Tk6X0pH/hVKisUlJ4aCZEpN1L2Qj1v/4U=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false

notifications:
  email:
    recipients:
      - travisci@portapps.io
    on_success: always
    on_failure: always
